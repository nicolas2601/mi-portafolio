---
import '../styles/global.css';
import Logo from '../components/ui/Logo.astro';

export interface Props{
	title: string;
	description?: string;
}

const {title, description = "Portafolio de Nicolas Moreno - desarrollador backend"} = Astro.props;
---
<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="description" content={description} />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<title>{title}</title>
  </head>
  <body class="bg-gray-900 text-white min-h-screen">
    <nav class="fixed top-0 w-full bg-gray-900/80 backdrop-blur-md z-50 border-b border-gray-800">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex items-center justify-between h-16">
          <div class="flex-shrink-0 flex items-center">
            <a href="/" class="flex items-center">
              <Logo />
            </a>
          </div>
          <!-- Menú Desktop -->
          <div class="hidden md:block">
            <div class="ml-10 flex items-baseline space-x-4">
              <a href="/" class="hover:text-gray-300 px-3 py-2 rounded-md text-sm font-medium transition-colors">Inicio</a>
              <a href="/about" class="hover:text-gray-300 px-3 py-2 rounded-md text-sm font-medium transition-colors">Sobre Mí</a>
              <a href="/projects" class="hover:text-gray-300 px-3 py-2 rounded-md text-sm font-medium transition-colors">Proyectos</a>
              <a href="/contact" class="hover:text-gray-300 px-3 py-2 rounded-md text-sm font-medium transition-colors">Contacto</a>
            </div>
          </div>
          
          <!-- Botón Hamburger Móvil -->
          <div class="md:hidden">
            <button 
              id="mobile-menu-button" 
              type="button"
              class="text-gray-400 hover:text-white focus:outline-none focus:text-white transition-colors duration-300"
              aria-label="Abrir menú de navegación"
              aria-expanded="false"
              aria-controls="mobile-menu"
            >
              <svg id="hamburger-icon" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
              </svg>
              <svg id="close-icon" class="h-6 w-6 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>
          </div>
        </div>
      </div>
      
      <!-- Menú Móvil Desplegable -->
      <div 
        id="mobile-menu" 
        class="md:hidden hidden bg-gray-900/95 backdrop-blur-md border-t border-gray-800 transform transition-all duration-300 ease-in-out"
        role="menu"
        aria-labelledby="mobile-menu-button"
      >
        <div class="px-2 pt-2 pb-3 space-y-1">
          <a href="/" class="block px-3 py-2 rounded-md text-base font-medium text-gray-300 hover:text-white hover:bg-gray-800 transition-all duration-300" role="menuitem">Inicio</a>
          <a href="/about" class="block px-3 py-2 rounded-md text-base font-medium text-gray-300 hover:text-white hover:bg-gray-800 transition-all duration-300" role="menuitem">Sobre Mí</a>
          <a href="/projects" class="block px-3 py-2 rounded-md text-base font-medium text-gray-300 hover:text-white hover:bg-gray-800 transition-all duration-300" role="menuitem">Proyectos</a>
          <a href="/contact" class="block px-3 py-2 rounded-md text-base font-medium text-gray-300 hover:text-white hover:bg-gray-800 transition-all duration-300" role="menuitem">Contacto</a>
        </div>
      </div>
    </nav>
    
    <main class="pt-16">
      <slot />
    </main>

    <footer>
      <div class="max-w-7xl sm:px-6 lg:px-8 py-8">
        <p class="text-center text-gray-400 text-sm">
          © {new Date().getFullYear()} Nicolas Moreno. Todos los derechos reservados.
        </p>
      </div>
    </footer>

    <script>
      // JavaScript optimizado para el menú móvil
      document.addEventListener('DOMContentLoaded', function() {
        // Obtener elementos del DOM con validación de null
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        const hamburgerIcon = document.getElementById('hamburger-icon');
        const closeIcon = document.getElementById('close-icon');
        
        // Validación crítica: verificar que todos los elementos existen
        if (!mobileMenuButton || !mobileMenu || !hamburgerIcon || !closeIcon) {
          console.warn('Elementos del menú móvil no encontrados. Funcionalidad deshabilitada.');
          return;
        }
        
        let isMenuOpen = false;
        
        // Función para alternar el menú con validaciones
        function toggleMenu() {
          isMenuOpen = !isMenuOpen;
          
          // Actualizar aria-expanded para accesibilidad
          if (mobileMenuButton) {
            mobileMenuButton.setAttribute('aria-expanded', isMenuOpen.toString());
          }
          
          if (isMenuOpen) {
            // Mostrar menú con validaciones
            if (mobileMenu) {
              mobileMenu.classList.remove('hidden');
              mobileMenu.style.maxHeight = mobileMenu.scrollHeight + 'px';
            }
            if (hamburgerIcon) hamburgerIcon.classList.add('hidden');
            if (closeIcon) closeIcon.classList.remove('hidden');
            
            // Actualizar aria-label
            if (mobileMenuButton) mobileMenuButton.setAttribute('aria-label', 'Cerrar menú de navegación');
          } else {
            // Ocultar menú con validaciones
            if (mobileMenu) {
              mobileMenu.style.maxHeight = '0';
              setTimeout(() => {
                if (mobileMenu) mobileMenu.classList.add('hidden');
              }, 300);
            }
            if (hamburgerIcon) hamburgerIcon.classList.remove('hidden');
            if (closeIcon) closeIcon.classList.add('hidden');
            
            // Actualizar aria-label
            if (mobileMenuButton) mobileMenuButton.setAttribute('aria-label', 'Abrir menú de navegación');
          }
        }
        
        // Event listener para el botón del menú con validación
        if (mobileMenuButton) {
          mobileMenuButton.addEventListener('click', function(e) {
            e.preventDefault();
            toggleMenu();
          });
        }
        
        // Cerrar menú al hacer click en un enlace con validación
        if (mobileMenu) {
          const mobileLinks = mobileMenu.querySelectorAll('a');
          if (mobileLinks && mobileLinks.length > 0) {
            mobileLinks.forEach(link => {
              if (link) {
                link.addEventListener('click', function() {
                  if (isMenuOpen) {
                    toggleMenu();
                  }
                });
              }
            });
          }
        }
        
        // Cerrar menú al presionar Escape
        document.addEventListener('keydown', function(e) {
          if (e.key === 'Escape' && isMenuOpen) {
            toggleMenu();
          }
        });
        
        // Cerrar menú al hacer click fuera de él
        document.addEventListener('click', function(e) {
          if (isMenuOpen && mobileMenu && mobileMenuButton && 
              !mobileMenu.contains(e.target as Node) && !mobileMenuButton.contains(e.target as Node)) {
            toggleMenu();
          }
        });
        
        // Manejar cambios de tamaño de ventana
        let resizeTimeout: number;
        window.addEventListener('resize', function() {
          clearTimeout(resizeTimeout);
          resizeTimeout = window.setTimeout(function() {
            // Si la ventana se hace más grande, cerrar el menú móvil
            if (window.innerWidth >= 768 && isMenuOpen) {
              toggleMenu();
            }
          }, 250);
        });
      });
    </script>
  </body>
</html>